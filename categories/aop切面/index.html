<!doctype html><html lang=zh-CN><head><title>// 笔记网站</title>
<link rel="shortcut icon" href=/favicon.ico><meta charset=utf-8><meta name=generator content="Hugo 0.121.0"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="borong.cheng"><meta name=description content><link rel=stylesheet href=/css/main.min.5b1fcc8902588589c4767187402a3c29f8b8d7a6fdef6d9f8f77045bb0d14fee.css><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://borongcheng.github.io/%E9%A6%96%E9%A1%B5%E4%B8%AD%E9%97%B4%E7%9A%84%E5%9B%BE%E7%89%87"><meta name=twitter:title content><meta name=twitter:description content="Spring AOP 详解 一、什么是AOP 文章链接： ​ 你知道Spring AOP创建Proxy的过程吗？ ​ https://zhuanlan.zhihu.com/p/413961861 ​ AOP，即面向切面编程，可以说是OOP（面向对象编"><meta property="og:title" content><meta property="og:description" content="Spring AOP 详解 一、什么是AOP 文章链接： ​ 你知道Spring AOP创建Proxy的过程吗？ ​ https://zhuanlan.zhihu.com/p/413961861 ​ AOP，即面向切面编程，可以说是OOP（面向对象编"><meta property="og:type" content="article"><meta property="og:url" content="https://borongcheng.github.io/categories/aop%E5%88%87%E9%9D%A2/"><meta property="og:image" content="https://borongcheng.github.io/%E9%A6%96%E9%A1%B5%E4%B8%AD%E9%97%B4%E7%9A%84%E5%9B%BE%E7%89%87"><meta property="article:section" content="categories"><meta property="og:site_name" content="柏荣的博客"></head><body><header class=app-header><a href=https://borongcheng.github.io/><img class=app-header-avatar src=/avatar.jpg alt=borong.cheng></a>
<span class=app-header-title>笔记网站</span><nav class=app-header-menu><a class=app-header-menu-item href=/posts/>文章</a>
-
<a class=app-header-menu-item href=/tags/>标签</a>
-
<a class=app-header-menu-item href=/categories/>分类</a></nav><p>柏荣的博客</p></header><main class=app-container><article class=post><header class=post-header><h1 class=post-title></h1><div class=post-meta><div><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>Jan 1, 0001</div><div><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>6 min read</div></div></header><div class=post-content><h1 id=spring-aop-详解>Spring AOP 详解</h1><h1 id=一什么是aop>一、什么是AOP</h1><p><strong>文章链接：</strong></p><p>​ 你知道Spring AOP创建Proxy的过程吗？</p><p>​ https://zhuanlan.zhihu.com/p/413961861</p><p>​ AOP，即面向切面编程，可以说是OOP（面向对象编程）的一种补充和完善。OOP引入封装、继承、多态等概念来建立一种对象的层次结构，用于模拟公众行为的一个集合。不过OOP允许开发者定义纵向关系，但并不适合定义横向关系，例如日志功能。</p><p>​ 日志代码往往横向的散布在所有对象层次中，而与它对应的对象的核心功能毫无关系对于其他类型的代码，如安全性、异常处理和透明的持续性也是如此，这种散步在各处的无关代码被称为横切。</p><p>​ 在OOP设计中，它导致了大量代码重复，而不利于各个模块的重用；AOP技术恰恰相反，它利用一种称为“横切”的技术，剖解开封装对象内部，并将那些影响多个类的公共行为封装到一个可重用的模块，并将其命名为“Aspect”，即。切面，所谓切面，简单说就是那些与业务无关，却为业务模块所共同调用的逻辑或责任封装起来，便于减少系统的重复代码，降低模块之间的耦合度，并有利于未来的可操作性和可维护性。</p><p>​ 使用“横切”技术，AOP把软件系统分成了两个部分：核心关注点和横切关注点。业务处理的主要流程是核心关注点，与之前关系不大的部分是横切关注点。横切关注点的一个特点是，他们经常发生在核心关注点的多处，而且各处基本相似，比如权限认证、日志、事物。</p><p>​ AOP的作用在于分离系统中的各种关注点，将核心关注点和横切关注点分离开来。</p><h1 id=二aop核心概念>二、AOP核心概念</h1><h2 id=1横切关注点>1、横切关注点</h2><p>​ 对哪些方法进行拦截，拦截后怎么处理，这些关注点称为横切关注点。</p><h2 id=2切面aspect>2、切面（Aspect）</h2><p>​ 类是对物体特征的抽象，切面是对横切关注点的抽象。</p><p>​ 个人理解：对需要切的地方抽象出来，然后在切面处理逻辑中对这个切点做前置后置操作。</p><h2 id=3连接点joinpoint>3、连接点（Joinpoint）</h2><p>​ 我们知道了要切哪些方法后，剩下的是什么时候切，在原方法的哪一个执行阶段加入增加代码，这个就是切点。如方法调用前，调用后，发生异常时。</p><h2 id=4切入点pointcut>4、切入点（Pointcut）</h2><p>​ 要对哪些类中的哪些方法进行增强，进行切割，指的是被增强的方法。要切哪些东西。</p><h2 id=5通知advice>5、通知（advice）</h2><p>​ 所谓通知指的就是拦截到连接点之后要执行的代码，通知分为前置和后置、异常、最终、环绕五种通知。</p><h2 id=6目标对象>6、目标对象</h2><p>​ 被一个切面或者多个切面所通知的对象，即为目标对象。</p><h2 id=7代理对象>7、代理对象</h2><p>​ AOP代理是AOP框架所生成的对象，该对象是目标对象的代理对象。代理对象能够在目标对象的基础上，在相应的连接点上调用通知。</p><h2 id=8织入weave>8、织入（weave）</h2><p>​ 将切面应用到目标对象并导致代理对象创建的过程。</p><h2 id=9引入introduction>9、引入（introduction）</h2><p>​ 在不修改原来代码的前提下，引入可以在运行期间为类动态的添加一些方法或字段。</p><h1 id=三springboot实现日志切面>三、SpringBoot实现日志切面</h1><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Slf4j</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Component</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Aspect</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>RequestLogAspect</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Resource</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>HttpServletRequest</span><span class=w> </span><span class=n>request</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 服务端切点
</span></span></span><span class=line><span class=cl><span class=cm>     * */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Pointcut</span><span class=p>(</span><span class=s>&#34;execution(* com.saimo.uavinfomanage.servercontroller.*.*(..))&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>webLogServer</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 客户端切点
</span></span></span><span class=line><span class=cl><span class=cm>     * */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Pointcut</span><span class=p>(</span><span class=s>&#34;execution(* com.saimo.uavinfomanage.clientcontroller.*.*(..))&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>webLogClient</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 声明环绕通知
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Around</span><span class=p>(</span><span class=s>&#34;webLogServer()||webLogClient()&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=nf>doAroundServer</span><span class=p>(</span><span class=n>ProceedingJoinPoint</span><span class=w> </span><span class=n>joinPoint</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Throwable</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 记录下请求内容</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Object</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Exception</span><span class=w> </span><span class=n>exception</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>joinPoint</span><span class=p>.</span><span class=na>proceed</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>exception</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>e</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>log</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;----------------------------------------------------------------------------------------&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>log</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;----------请求地址 : &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>request</span><span class=p>.</span><span class=na>getRequestURL</span><span class=p>().</span><span class=na>toString</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>log</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;----------请求类型 : &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>request</span><span class=p>.</span><span class=na>getMethod</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>log</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;----------IP : &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>request</span><span class=p>.</span><span class=na>getRemoteAddr</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>log</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;----------类方法 : &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>joinPoint</span><span class=p>.</span><span class=na>getSignature</span><span class=p>().</span><span class=na>getDeclaringTypeName</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;.&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>joinPoint</span><span class=p>.</span><span class=na>getSignature</span><span class=p>().</span><span class=na>getName</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>log</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;----------参数 : &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>Arrays</span><span class=p>.</span><span class=na>toString</span><span class=p>(</span><span class=n>joinPoint</span><span class=p>.</span><span class=na>getArgs</span><span class=p>()));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>exception</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>exception</span><span class=w> </span><span class=k>instanceof</span><span class=w> </span><span class=n>BusinessException</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=n>log</span><span class=p>.</span><span class=na>error</span><span class=p>(</span><span class=s>&#34;----------异常 :&#34;</span><span class=o>+</span><span class=p>((</span><span class=n>BusinessException</span><span class=p>)</span><span class=n>exception</span><span class=p>).</span><span class=na>getMsg</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=k>throw</span><span class=w> </span><span class=n>exception</span><span class=p>;</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>log</span><span class=p>.</span><span class=na>error</span><span class=p>(</span><span class=s>&#34;----------异常 :&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>exception</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>log</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;----------返回 :&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>JSON</span><span class=p>.</span><span class=na>toJSONString</span><span class=p>(</span><span class=n>result</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>log</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;----------------------------------------------------------------------------------------&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>result</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h1 id=四自定义注解事项>四、自定义注解事项</h1><h2 id=1interface>1、@interface</h2><ul><li>用@interface来声明一个注解</li><li>其中的每一个方法声明就是声明的一个配置参数<ul><li>方法的名称就是参数的名称。</li><li>返回值的类型就是参数的类型（返回值类型只能是基本类型、Class、String、enum）。</li><li>可以通过default来声明参数的默认值。</li><li>如果只有一个成员，一般参数名为value</li></ul></li></ul><p><strong>注意事项：</strong></p><p>​ 1、 注解元素必须有值。我们定义注解元素时，经常使用空字符串，0作为默认值。</p><p>​ 2、 也经常使用负数（-1）表示不存在的含义。</p><h2 id=2元注解>2、元注解</h2><p>​ 元注解的作用就是负责注解其他注解。在Java中定义了4个标准的meta-annotation类型，它们被用来提供对其他annotation类型做说明。</p><p>1）、Target</p><p>2）、Rentention</p><p>3）、Documented</p><p>4）、Inherited</p><p>​ 这些注解和它们所支持的类型在java.lang.annotation包中可以看到。</p><h2 id=3target>3、@Target</h2><p><strong>作用：</strong></p><p>​ 用于描述注解的使用范围（即被描述的注解可以用在什么地方）</p><table><thead><tr><th>所修饰范围</th><th>取值ElementType</th></tr></thead><tbody><tr><td>package包</td><td>PACKAGE</td></tr><tr><td>类、接口、枚举、Annotation类型</td><td>TYPE</td></tr><tr><td>类型成员（方法、构造方法、成员变量、枚举值）</td><td>CONSTRUCTOR：用于描述构造器 FIELD：用于描述作用域 METHOD：用于描述方法</td></tr><tr><td>方法参数和本地变量</td><td>LOCA_VARIABLE：用于描述局部变量 PARAMETER：用于描述参数</td></tr></tbody></table><p>​ 取多个范围可以用逗号隔开</p><p>​ 例如：@Target({ElementType.METHOD,ElementType.TYPE})</p><h2 id=4retention>4、@Retention</h2><p><strong>作用：</strong></p><p>​ 表示需要在什么级别保存该注解信息，用于描述注解的生命周期。</p><table><thead><tr><th>取值RetentionPolicy</th><th>作用</th></tr></thead><tbody><tr><td>SOURCE</td><td>在源文件中有效，即源文件中保留</td></tr><tr><td>CLASS</td><td>在class文件中有效，即class文件中保留</td></tr><tr><td>RUNTIME</td><td>在运行时有效，即运行时保留，被加载到程序中，可以被反射机制读取</td></tr></tbody></table><h2 id=5自定义注解>5、自定义注解</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Target</span><span class=p>({</span><span class=n>ElementType</span><span class=p>.</span><span class=na>METHOD</span><span class=p>,</span><span class=n>ElementType</span><span class=p>.</span><span class=na>TYPE</span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Retention</span><span class=p>(</span><span class=n>RetentionPolicy</span><span class=p>.</span><span class=na>RUNTIME</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Documented</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=nd>@interface</span><span class=w> </span><span class=n>NotificationRecord</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>NotificationEnum</span><span class=w> </span><span class=nf>value</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=nf>key</span><span class=p>()</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=s>&#34;&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=nf>expand</span><span class=p>()</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=s>&#34;&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>	
</span></span></span></code></pre></td></tr></table></div></div><h1 id=五注解动态获取方法形参>五、注解动态获取方法形参</h1><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=nf>invoke</span><span class=p>(</span><span class=n>ProceedingJoinPoint</span><span class=w> </span><span class=n>joinPoint</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>//获取方法上的注解</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>MethodSignature</span><span class=w> </span><span class=n>signature</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>MethodSignature</span><span class=p>)</span><span class=n>joinPoint</span><span class=p>.</span><span class=na>getSignature</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>NotificationRecord</span><span class=w> </span><span class=n>notificationRecord</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>signature</span><span class=p>.</span><span class=na>getMethod</span><span class=p>().</span><span class=na>getAnnotation</span><span class=p>(</span><span class=n>NotificationRecord</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>//获取注解传入的表达式</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>String</span><span class=w> </span><span class=n>key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>notificationRecord</span><span class=p>.</span><span class=na>key</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>//创建解析器</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>SpelExpressionParser</span><span class=w> </span><span class=n>parser</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>SpelExpressionParser</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>//将表达式放入解析器</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>Expression</span><span class=w> </span><span class=n>expression</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>parser</span><span class=p>.</span><span class=na>parseException</span><span class=p>(</span><span class=n>key</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>//设置解析上下文（有哪些占位符，以及每种占位符的值）</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>StandardEvaluationContext</span><span class=w> </span><span class=n>context</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>StandardEvaluationContext</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>//通过反射的方法对象获取参数值数组</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>Object</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>joinPoint</span><span class=p>.</span><span class=na>getArgs</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>//获取运行时参数的名称</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>DefaultParameterNameDiscoverer</span><span class=w> </span><span class=n>discoverer</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>DefaultParameterNameDiscoverer</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>parameterNames</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>discoverer</span><span class=p>.</span><span class=na>getParameterNames</span><span class=p>(</span><span class=n>signature</span><span class=p>.</span><span class=na>getMethod</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>//将参数名和参数值一一对应注入到解析上下文中</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>for</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>Objects</span><span class=p>.</span><span class=na>requireNonNull</span><span class=p>(</span><span class=n>parameterNames</span><span class=p>).</span><span class=na>length</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>context</span><span class=p>.</span><span class=na>setVariable</span><span class=p>(</span><span class=n>parameterNames</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>,</span><span class=n>arg</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>//解析，获取解析替换后的结果</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>String</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>expression</span><span class=p>.</span><span class=na>getValue</span><span class=p>(</span><span class=n>context</span><span class=p>).</span><span class=na>toString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></div><div class=post-footer></div></article></main></body></html>